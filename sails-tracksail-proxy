#!/usr/bin/env python3

import socketserver

def get_attribute(attr):
    return '10'

class TracksailTCPHandler(socketserver.BaseRequestHandler):
    def handle(self):
        while True:
            data = self.request.recv(1024) \
                       .decode('utf-8') \
                       .strip(' \0') \
                       .split(' ')

            print('{} wrote: {}'.format(self.client_address[0], data))

            command = data.pop(0)

            if command == 'get':
                attribute = data.pop(0)
                ret = get_attribute(attribute)
                self.request.sendall(ret.encode())
            elif command == 'set':
                self.request.sendall(b'OK')
            else:
                self.request.sendall(b'ERROR')

if __name__ == "__main__":
    HOST, PORT = 'localhost', 5555

    server = socketserver.TCPServer((HOST, PORT), TracksailTCPHandler)
    server.serve_forever()
